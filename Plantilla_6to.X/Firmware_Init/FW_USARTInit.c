/**********************************************************************************************************
*                                              USART
                    *						Módulo para trabajar con la USART
*
*						<Copyright>
*
*						<Copyright or distribution terms>
*
*
*********************************************************************************************************/

/*********************************************************************************************************
*                                               FW_USARTInit.c
*
* Filename	: FW_USARTInit.c
* Version	: 1.0.0					
* Programmer(s) : NEF
**********************************************************************************************************
*  Note(s):
*
*
*
*********************************************************************************************************/

/*********************************************************************************************************
 *
 * \file		FW_USARTInit.c
 * \brief		Módulo para trabajar con la UART
 * \date		1 de octubre de 2019
 * \author		Nicolas Ferragamo nferragamo@est.frba.utn.edu.ar
 * \version     1.0.0
*********************************************************************************************************/

/*********************************************************************************************************
 *** INCLUDES
*********************************************************************************************************/

#include <xc.h>
#include "USART.h"

#if SHIELD_ACTIVO == __SHIELD2
/*********************************************************************************************************
 *** DEFINES PRIVADOS AL MODULO
*********************************************************************************************************/

/*********************************************************************************************************
 *** MACROS PRIVADAS AL MODULO
*********************************************************************************************************/

/*********************************************************************************************************
 *** TIPOS DE DATOS PRIVADOS AL MODULO
*********************************************************************************************************/

/*********************************************************************************************************
 *** TABLAS PRIVADAS AL MODULO
*********************************************************************************************************/

/*********************************************************************************************************
 *** VARIABLES GLOBALES PUBLICAS
*********************************************************************************************************/

/*********************************************************************************************************
 *** VARIABLES GLOBALES PRIVADAS AL MODULO
*********************************************************************************************************/

/*********************************************************************************************************
 *** PROTOTIPO DE FUNCIONES PRIVADAS AL MODULO
*********************************************************************************************************/

/*********************************************************************************************************
 *** FUNCIONES PRIVADAS AL MODULO
*********************************************************************************************************/

/*********************************************************************************************************
 *** FUNCIONES GLOBALES AL MODULO
*********************************************************************************************************/

/**
	\fn  		void USART_Init (void);
	\brief 		Se encarga de inicializar la USART
 	\author 	
 	\date 		
 	\param [in]     void
 	\param [out] 	void
*/
void USART_Init (void)
{
    TXSTAbits.BRGH    = 1;     // High Baud Rate Select bit
    BAUDCONbits.BRG16 = 1;
    TXSTAbits.SYNC    = 0;     //modo asincrónico
    SPBRG             = 0xE1;
    SPBRGH            = 0x04;  //=(FOSC/9600)/4-1 donde FOSC=48MHz
    RCSTAbits.SPEN    = 1;      //Habilita el puerto serie
    
    //transmisión
    TXSTAbits.TX9     = 0;     //recepción y transmisión de 8 bits
    TXSTAbits.TXEN    = 0;     //Inicialmente el transmisor está desactivado.
   
    //recepción
    (void) RCREG;             //Se vacia el buffer
    (void) RCREG;
    (void) RCREG;
    RCSTAbits.RX9     = 0 ;   //Recepción de 8 bits
    PIE1bits.RCIE     = 1;    //habilita la interrupción de recepción
    RCSTAbits.CREN    = 1;    //Habilita la recepción
    INTCONbits.PEIE   = 1;    //Habilita las interrupciones parcialmente

    TRISCbits.RC6     = 1;    //RC6 y RC7 alta impedancia
    TRISCbits.RC7     = 1;
    BAUDCONbits.RXDTP = 1;    //La información se recive con polaridad invertida
                              //Esto es para poder funcionar con el ID-12LA, en
                              //caso de cambiar el selector de recepción comentar
                              //esta linea.
}

#endif /* SHIELD_ACTIVO */