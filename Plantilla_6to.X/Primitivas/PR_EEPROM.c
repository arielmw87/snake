/**********************************************************************************************************
*                                               EEPROM
                    *						Módulo para trabajar con memoria EEPROM
*
*						<Copyright>
*
*						<Copyright or distribution terms>
*
*
*********************************************************************************************************/

/*********************************************************************************************************
*                                               PR_EEPROM.c
*
* Filename	: PR_EEPROM.c
* Version	: 1.0.0					
* Programmer(s) : NEF
**********************************************************************************************************
*  Note(s):
*
*
*
*********************************************************************************************************/

/*********************************************************************************************************
 *
 * \file		PR_EEPROM.c
 * \brief		Módulo para trabajar con memoria EEPROM
 * \date		1 de octubre de 2019
 * \author		Nicolas Ferragamo nferragamo@est.frba.utn.edu.ar
 * \version     1.0.0
*********************************************************************************************************/

/*********************************************************************************************************
 *** INCLUDES
*********************************************************************************************************/
#include <xc.h>
#include "EEPROM.h"

/*********************************************************************************************************
 *** DEFINES PRIVADOS AL MODULO
*********************************************************************************************************/

/*********************************************************************************************************
 *** MACROS PRIVADAS AL MODULO
*********************************************************************************************************/

/*********************************************************************************************************
 *** TIPOS DE DATOS PRIVADOS AL MODULO
*********************************************************************************************************/

/*********************************************************************************************************
 *** TABLAS PRIVADAS AL MODULO
*********************************************************************************************************/

/*********************************************************************************************************
 *** VARIABLES GLOBALES PUBLICAS
*********************************************************************************************************/

/*********************************************************************************************************
 *** VARIABLES GLOBALES PRIVADAS AL MODULO
*********************************************************************************************************/

/*********************************************************************************************************
 *** PROTOTIPO DE FUNCIONES PRIVADAS AL MODULO
*********************************************************************************************************/

/*********************************************************************************************************
 *** FUNCIONES PRIVADAS AL MODULO
*********************************************************************************************************/

/*********************************************************************************************************
 *** FUNCIONES GLOBALES AL MODULO
*********************************************************************************************************/

/**
	\fn  		void EEPROM_Write(uint8_t addr,uint8_t n);
	\brief 		Se encarga de escribir un dato en la memoria EEPROM
 	\author 	
 	\date 		
 	\param [in]     addr
    \param [in]     n
 	\param [out] 	void
*/
void EEPROM_Write (uint8_t addr,uint8_t n)
{
    EEADR  = (uint8_t)addr;
    EEDATA = n;

    EECON1bits.EEPGD = 0;        // Point to Data Memory
    EECON1bits.CFGS  = 0;        // Access EEPROM
    EECON1bits.WREN  = 1;

    INTCONbits.GIE   = 0;        // disattiva interrupt globali
    EECON2           = 0x55;     // Write 55h
    EECON2           = 0xAA;     // Write AAh
    EECON1bits.WR    = 1;        // abilita write.
    INTCONbits.GIE   = 1;        // attiva interrupt globali
    
    do {
        ClrWdt();
        } while(EECON1bits.WR);                            // occupato ? 


    EECON1bits.WREN  = 0;                                // disabilita write.
}


/**
	\fn  		void EEPROM_Read(uint8_t addr,uint8_t n);
	\brief 		Se encarga de escribir un dato en la memoria EEPROM
 	\author 	
 	\date 		
 	\param [in]     addr
 	\param [out] 	EEDATA
*/
uint8_t EEPROM_Read (uint8_t addr)
{
    EEADR = (uint8_t)addr;       // Address to read
    EECON1bits.EEPGD = 0;        // Point to Data Memory
    EECON1bits.CFGS  = 0;        // Access EEPROM
    EECON1bits.RD    = 1;        // EE Read
    return EEDATA;               // W = EEDATA
}