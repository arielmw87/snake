/**********************************************************************************************************
*                                               PWM
*                                           Manejo de PWM
*
*						<Copyright>
*
*						<Copyright or distribution terms>
*
*
*********************************************************************************************************/

/*********************************************************************************************************
*                                               PR_PWM.c
*
* Filename	: PR_PWM.c
* Version	: 1.0.0					
* Programmer(s) : NEF
**********************************************************************************************************
*  Note(s):
*
*
*
*********************************************************************************************************/

/*********************************************************************************************************
 *
 * \file		PR_PWM.c
 * \brief		Manejo de PWM
 * \date		1 de octubre de 2019
 * \author		Nicolas Ferragamo nferragamo@est.frba.utn.edu.ar
 * \version     1.0.0
*********************************************************************************************************/

/*********************************************************************************************************
 *** INCLUDES
*********************************************************************************************************/

#include <xc.h>
#include "PWM.h"

/*********************************************************************************************************
 *** DEFINES PRIVADOS AL MODULO
*********************************************************************************************************/

/*********************************************************************************************************
 *** MACROS PRIVADAS AL MODULO
*********************************************************************************************************/

/*********************************************************************************************************
 *** TIPOS DE DATOS PRIVADOS AL MODULO
*********************************************************************************************************/

/*********************************************************************************************************
 *** TABLAS PRIVADAS AL MODULO
*********************************************************************************************************/

/*********************************************************************************************************
 *** VARIABLES GLOBALES PUBLICAS
*********************************************************************************************************/
volatile uint16_t PWM_Frecuencia = 1000;

/*********************************************************************************************************
 *** VARIABLES GLOBALES PRIVADAS AL MODULO
*********************************************************************************************************/

/*********************************************************************************************************
 *** PROTOTIPO DE FUNCIONES PRIVADAS AL MODULO
*********************************************************************************************************/

/*********************************************************************************************************
 *** FUNCIONES PRIVADAS AL MODULO
*********************************************************************************************************/

/*********************************************************************************************************
 *** FUNCIONES GLOBALES AL MODULO
*********************************************************************************************************/


/**
	\fn  		void PWM_PeriodoUp (uint8_t valor)
	\brief 		Aumenta el periodo del PWM
 	\author 	Nombre
 	\date 		${date}
 	\param [in] 	void
 	\param [out] 	void
*/
void PWM_PeriodoUp (uint8_t valor)
{
     if(PWM_Frecuencia > 1)
     {
        PWM_Frecuencia -= valor;
        PWM_CalcFrec();
     }
}


/**
	\fn  		void PWM_PeriodoDown (uint8_t valor)
	\brief 		Disminuye el periodo del PWM
 	\author 	Nombre
 	\date 		${date}
 	\param [in] 	void
 	\param [out] 	void
*/
void PWM_PeriodoDown (uint8_t valor)
{
    if(PWM_Frecuencia < 1000)
    {
        PWM_Frecuencia += valor;
        PWM_CalcFrec();
    }
}


/**
	\fn  		void PWM_Set (uint8_t periodo, uint8_t duty);
	\brief 		Configura una modulación por ancho de pulso con frecuencia = 1/peiodo y ciclo de 
                trabajo = Duty 
 	\author 	Nombre
 	\date 		${date}
 	\param [in] 	periodo
 *  \param [in] 	duty
 	\param [out] 	void
*/
void PWM_Set (uint8_t periodo, uint8_t duty)
{
    if(duty > 0 && duty != CCPR1L)
    {
        CCPR1L=duty;      //si el valor de duty es correcto lo carga en el registro correspondiente
    }
    if(periodo > 0 && periodo != PR2)
    {
        PR2=periodo;       //si el valor del período es correcto lo carga en el registri correspondiente
    }
}